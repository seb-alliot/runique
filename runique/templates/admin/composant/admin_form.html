{% extends "admin_base.html" %}

{% block title %}
    {% if is_edit %}Modifier{% else %}Créer{% endif %} — {{ resource.title }}
{% endblock %}

{% block breadcrumb %}
    <span class="breadcrumb-sep">/</span>
    <a href="/admin/{{ resource.key }}/list">{{ resource.title }}</a>
    <span class="breadcrumb-sep">/</span>
    <span>{% if is_edit %}Modifier #{{ object_id }}{% else %}Créer{% endif %}</span>
{% endblock %}

{% block content %}

<div class="page-header">
    <div>
        <h1 class="page-title">
            {% if is_edit %}Modifier {{ resource.title }}{% else %}Créer {{ resource.title }}{% endif %}
        </h1>
        {% if is_edit %}
        <p class="page-subtitle">ID : <span class="id-badge">{{ object_id }}</span></p>
        {% endif %}
    </div>
    <a href="/admin/{{ resource.key }}/list" class="btn btn-secondary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15">
            <polyline points="15 18 9 12 15 6"/>
        </svg>
        Retour à la liste
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">Informations</h2>
    </div>
    <div class="card-body">

        <form method="POST"
              action="{% if is_edit %}/admin/{{ resource.key }}/{{ object_id }}{% else %}/admin/{{ resource.key }}/create{% endif %}"
              enctype="multipart/form-data">

            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

            <div class="form-grid">

                {% for field in form_fields %}
                <div class="form-group {% if field.full_width %}form-grid-2{% endif %}">

                    <label class="form-label {% if field.required %}required{% endif %}"
                           for="{{ field.name }}">
                        {{ field.label }}
                    </label>

                    {% if field.widget == "textarea" %}
                        <textarea
                            class="form-textarea {% if field.error %}error{% endif %}"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            {% if field.required %}required{% endif %}
                            rows="4"
                        >{{ field.value | default(value='') }}</textarea>

                    {% elif field.widget == "select" %}
                        <select
                            class="form-select {% if field.error %}error{% endif %}"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            {% if field.required %}required{% endif %}
                        >
                            <option value="">— Choisir —</option>
                            {% for choice in field.choices %}
                            <option value="{{ choice.value }}"
                                {% if choice.value == field.value %}selected{% endif %}>
                                {{ choice.label }}
                            </option>
                            {% endfor %}
                        </select>

                    {% elif field.widget == "checkbox" %}
                        <label class="form-check">
                            <input
                                type="checkbox"
                                id="{{ field.name }}"
                                name="{{ field.name }}"
                                value="true"
                                {% if field.value %}checked{% endif %}
                            >
                            {{ field.label }}
                        </label>

                    {% elif field.widget == "password" %}
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="password"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            autocomplete="new-password"
                            {% if field.required and not is_edit %}required{% endif %}
                        >
                        {% if is_edit %}
                        <span class="form-hint">Laissez vide pour conserver le mot de passe actuel.</span>
                        {% endif %}

                    {% elif field.widget == "email" %}
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="email"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            value="{{ field.value | default(value='') }}"
                            {% if field.required %}required{% endif %}
                        >

                    {% elif field.widget == "number" %}
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="number"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            value="{{ field.value | default(value='') }}"
                            {% if field.required %}required{% endif %}
                        >

                    {% elif field.widget == "datetime" %}
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="datetime-local"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            value="{{ field.value | default(value='') }}"
                            {% if field.required %}required{% endif %}
                        >

                    {% elif field.widget == "file" %}
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="file"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            {% if field.required and not is_edit %}required{% endif %}
                        >
                        {% if field.value and is_edit %}
                        <span class="form-hint">Fichier actuel : {{ field.value }}</span>
                        {% endif %}

                    {% elif field.widget == "hidden" %}
                        <input type="hidden" name="{{ field.name }}" value="{{ field.value | default(value='') }}">

                    {% else %}
                        <!-- text par défaut -->
                        <input
                            class="form-input {% if field.error %}error{% endif %}"
                            type="text"
                            id="{{ field.name }}"
                            name="{{ field.name }}"
                            value="{{ field.value | default(value='') }}"
                            {% if field.required %}required{% endif %}
                        >
                    {% endif %}

                    {% if field.hint and field.widget != "password" %}
                    <span class="form-hint">{{ field.hint }}</span>
                    {% endif %}

                    {% if field.error %}
                    <span class="form-error">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        {{ field.error }}
                    </span>
                    {% endif %}

                </div>
                {% endfor %}

                {% if not form_fields %}
                <p style="color: var(--text-muted); font-size: 0.88rem;">
                    Aucun champ configuré. Vérifiez la définition du Form associé à cette ressource.
                </p>
                {% endif %}

            </div><!-- .form-grid -->

            <div class="form-actions">
                <a href="/admin/{{ resource.key }}/list" class="btn btn-secondary">Annuler</a>
                <button type="submit" class="btn btn-primary">
                    {% if is_edit %}Enregistrer les modifications{% else %}Créer{% endif %}
                </button>
            </div>

        </form>

    </div>
</div>

{% if is_edit %}
<div class="delete-zone">
    <div class="delete-zone-text">
        <div class="delete-zone-title">Zone dangereuse</div>
        Supprimer définitivement cette entrée. Cette action est irréversible.
    </div>
    <form method="POST" action="/admin/{{ resource.key }}/{{ object_id }}/delete"
          onsubmit="return confirm('Supprimer définitivement cette entrée ?')">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="submit" class="btn btn-danger">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6l-1 14H6L5 6"/>
                <path d="M10 11v6M14 11v6"/>
                <path d="M9 6V4h6v2"/>
            </svg>
            Supprimer
        </button>
    </form>
</div>
{% endif %}

{% endblock %}
