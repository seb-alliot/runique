<div class="field-group mb-3">
    <label for="id_{{ name }}" class="form-label">
        {{ label }}
    </label>

    <input
        type="file"
        name="{{ name }}"
        id="id_{{ name }}"
        class="form-control {% if error %}is-invalid{% endif %}"
        accept="image/*"
        onchange="previewImage_{{ name }}(this)">

    {# Prévisualisation #}
    <div id="preview_{{ name }}" class="mt-2" {% if not value or value == "" %}style="display: none;"{% endif %}>
        <img
            id="img_{{ name }}"
            {% if value and value != "" %}
            src="/static/uploads/{{ value }}"
            {% endif %}
            alt="Aperçu"
            class="img-thumbnail"
            style="max-width: 200px; max-height: 200px; object-fit: cover;">
    </div>

    {% if error %}
        <div class="invalid-feedback d-block">
            {{ error }}
        </div>
    {% endif %}

    {% if help_text %}
        <div class="form-text">
            {{ help_text }}
        </div>
    {% endif %}
</div>

<script>
function previewImage_{{ name }}(input) {
    const preview = document.getElementById('preview_{{ name }}');
    const img = document.getElementById('img_{{ name }}');
    const file = input.files[0];

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            img.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        preview.style.display = 'none';
    }
}
</script>